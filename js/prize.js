$(function(){var e={url:{getTicktes:"search.ca?type=getallawrad"},imgUrls:["camera","iphone","ipad","2000","1000","800","500","300"],prizeTypes:["佳能OS 760D 单反套机","iphone 6s 64G","iPad mini 16G","2000元摩登现金券","1000元摩登现金券","800元摩登现金券","500元摩登现金券","300元摩登现金券"],prizeList:[],init:function(){var e=this;g.checkLogin(function(){var t=g.getUserInfo();$("#prize_user").html(t.username+" "+t.mobile);var n=t.awardrank;n>=0?$("#ticket img").attr("src","../images/price/"+e.imgUrls[n]+".png"):$("#ticket img").bind("click",function(){document.location.href="details.html"}),e.renderBrand()},function(){alert("请先登录"),document.location.href="login.html"})},renderBrand:function(){var e=this;g.loadingMask.open(),$.ajax({url:g.url.host+e.url.getTicktes,cache:!1,success:function(t){t=JSON.parse(t);if(!t.result){alert("获取[获奖名单]失败，请刷新页面重试");return}e.prizeList=t.data,e.doRenderBrand(),g.loadingMask.close()},error:function(e){e.statusText=="timeout"?(alert("服务器请求超时无响应，请刷新页面"),document.location.reload()):alert("获取[获奖名单]失败，请刷新页面重试")}})},doRenderBrand:function(){var e=this,t=this.prizeList,n=$("#list");if(t.length==0){n.html("<li>目前还没有人获奖</li>");return}for(var r=0,i=t.length;r<i;r++)n[0].innerHTML+="<li>恭喜 "+t[r].username+": 获得"+e.prizeTypes[t[r].awardrank]+"</li>";this.fitBrandHeight();var s=n.outerHeight(),o=$("#brand").outerHeight(),u=0,a=3;if(s<=o+a*10)return;setInterval(function(){u<o-s?u=0:u-=a,n[0].style.marginTop=u+"px"},100)},fitBrandHeight:function(){var e=/iPhone/ig.test(window.navigator.userAgent),t=e?window.devicePixelRatio:1;if(!e)return;var n=window.screen.availHeight*t-$("#caption").outerHeight()-$("#ticket").outerHeight()-64;$("#brand").height(n)}};e.init()});